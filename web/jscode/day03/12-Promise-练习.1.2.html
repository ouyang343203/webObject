<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>继Promise-模拟用户名的验证1.1</title>
</head>

<body>
    <script>
        //============================变更前=======================================
        // var promise = new Promise((resolve, reject) => {
        //     console.log('验证用户名...')
        //     //调用 
        //     setTimeout(() => {
        //         var num = Math.random()
        //         num > 0.3 ? resolve({ n: num, msg: '用户名正确' }) : reject({ n: num, msg: '用户名错误' })
        //     }, 1000);
        //     resolve()//触发下面的then
        //     reject()//触发下面的catch
        // })

        // promise.then(res => {
        //     console.log('res:resolover触发')
        // })
        // promise.catch(err => {
        //     console.log('err:resolover触发')
        // })

        //============================变更后=======================================

        //检查用户名
        function chectUsername() {
            return new Promise((resolve, reject) => {
                console.log('验证用户名...')
                //调用
                setTimeout(() => {
                    var num = Math.random()
                    num > 0.1 ? resolve({ n: num, msg: '用户名正确' }) : reject({ n: num, msg: '用户名错误' })
                }, 1000);
            })
        }


        //检查邮箱
        function checkEmail() {
            return new Promise((resolve, reject) => {
                console.log('检查邮箱...')
                //调用
                setTimeout(() => {
                    var num = Math.random()
                    num > 0.1 ? resolve({ n: num, msg: '邮箱正确' }) : reject({ n: num, msg: '邮箱错误' })
                }, 1000);

            })
        }

        //检验手机号
        function checkPhone() {
            return new Promise((resolve, reject) => {
                console.log('检验手机号...')
                //调用
                setTimeout(() => {
                    var num = Math.random()
                    num > 0.1 ? resolve({ n: num, msg: '手机号正确' }) : reject({ n: num, msg: '手机号错误' })
                }, 1000);

            })
        }

        //注册
        function register() {
            return new Promise((resolve, reject) => {
                console.log('注册...')
                //调用
                setTimeout(() => {
                    var num = Math.random()
                    num > 0.1 ? resolve({ n: num, msg: '注册成功' }) : reject({ n: num, msg: '注册失败' })
                }, 1000);

            })
        }

        chectUsername().then(res => {
            console.log('res:', res)
            //调用检查邮箱
            return checkEmail()//如果这里成功会调用下面的then
        }).then(res => {
            console.log('res:', res)
            //继续调用检查手机号
            return checkPhone()//如果这里成功会调用下面的then
        }).then(res => {
            console.log('res:', res)
            //继续调用注册
            return register()
        }).catch(err => {
            console.log('err:', err)
        })

        //语法糖用法
        // chectUsername()
        //     .then(res => checkEmail())
        //     .then(res => checkPhone())
        //     .then(res => register())
        //     .catch(err => console.log('err:', err))


    </script>
</body>

</html>